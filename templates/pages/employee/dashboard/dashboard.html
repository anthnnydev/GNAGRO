{% extends 'layouts/base.html' %}

{% block title %}Mi Panel - Portal Empleado{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header del Dashboard -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Mi Panel</h1>
                    <p class="text-gray-600 mt-1">Bienvenido, {{ employee.user.get_full_name }}</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        {% now "l, d F Y" %}
                    </div>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-building mr-2"></i>
                        {{ employee.department.name }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Información del Empleado -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
            <div class="flex items-center space-x-6">
                <div class="h-20 w-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                    {% if employee.user.profile_picture %}
                    <img src="{{ employee.user.profile_picture.url }}" alt="{{ employee.user.get_full_name }}" class="h-20 w-20 rounded-full object-cover">
                    {% else %}
                    <span class="text-2xl font-bold text-white">{{ employee.user.first_name|first|upper }}{{ employee.user.last_name|first|upper }}</span>
                    {% endif %}
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-semibold text-gray-900">{{ employee.user.get_full_name }}</h2>
                    <p class="text-gray-600">{{ employee.position.title }}</p>
                    <p class="text-sm text-gray-500">ID: {{ employee.employee_number }}</p>
                </div>
                <div class="text-right">
                    <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                        <i class="fas fa-circle text-green-400 mr-2 text-xs"></i>
                        {{ employee.get_status_display }}
                    </div>
                    <p class="text-sm text-gray-500 mt-1">{{ years_of_service }} años de servicio</p>
                </div>
            </div>
        </div>

        <!-- Tarjetas de estadísticas personales -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Tiempo de Servicio -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Tiempo de Servicio</p>
                        <p class="text-3xl font-bold text-blue-600">{{ years_of_service }}</p>
                        <p class="text-sm text-gray-500 mt-1">
                            {% if years_of_service == 1 %}año{% else %}años{% endif %}
                        </p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-briefcase text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Cumpleaños -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Días para Cumpleaños</p>
                        <p class="text-3xl font-bold text-purple-600">{{ days_until_birthday }}</p>
                        <p class="text-sm text-gray-500 mt-1">
                            {% if days_until_birthday == 0 %}¡Hoy!{% elif days_until_birthday == 1 %}mañana{% else %}días{% endif %}
                        </p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-birthday-cake text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Mis Documentos</p>
                        <p class="text-3xl font-bold text-green-600">{{ document_count }}</p>
                        <p class="text-sm text-gray-500 mt-1">archivos</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-file-alt text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Colegas del Departamento -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Colegas</p>
                        <p class="text-3xl font-bold text-orange-600">{{ department_colleagues }}</p>
                        <p class="text-sm text-gray-500 mt-1">en {{ employee.department.name }}</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-users text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Acciones Rápidas -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Acciones Rápidas</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <a href="{% url 'employees:employee_profile' %}" class="flex flex-col items-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors group">
                        <div class="bg-blue-600 p-3 rounded-full mb-3 group-hover:bg-blue-700 transition-colors">
                            <i class="fas fa-user text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Mi Perfil</span>
                    </a>

                    <a href="{% url 'employees:employee_documents' %}" class="flex flex-col items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors group">
                        <div class="bg-green-600 p-3 rounded-full mb-3 group-hover:bg-green-700 transition-colors">
                            <i class="fas fa-folder text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Documentos</span>
                    </a>

                    <a href="{% url 'employees:employee_payroll' %}" class="flex flex-col items-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors group">
                        <div class="bg-purple-600 p-3 rounded-full mb-3 group-hover:bg-purple-700 transition-colors">
                            <i class="fas fa-money-bill-wave text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Nómina</span>
                    </a>

                    <a href="{% url 'employees:employee_time' %}" class="flex flex-col items-center p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors group">
                        <div class="bg-yellow-600 p-3 rounded-full mb-3 group-hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-clock text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Horarios</span>
                    </a>

                    <a href="{% url 'employees:employee_requests' %}" class="flex flex-col items-center p-4 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors group">
                        <div class="bg-orange-600 p-3 rounded-full mb-3 group-hover:bg-orange-700 transition-colors">
                            <i class="fas fa-calendar-check text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Solicitudes</span>
                    </a>

                    <a href="{% url 'employees:employee_settings' %}" class="flex flex-col items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors group">
                        <div class="bg-gray-600 p-3 rounded-full mb-3 group-hover:bg-gray-700 transition-colors">
                            <i class="fas fa-cog text-white text-lg"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-900 text-center">Configuración</span>
                    </a>
                </div>
            </div>

            <!-- Información del Departamento -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Mi Departamento</h3>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-100 p-2 rounded-lg">
                            <i class="fas fa-building text-blue-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">{{ employee.department.name }}</p>
                            <p class="text-sm text-gray-500">Departamento</p>
                        </div>
                    </div>

                    {% if employee.supervisor %}
                    <div class="flex items-center space-x-3">
                        <div class="bg-green-100 p-2 rounded-lg">
                            <i class="fas fa-user-tie text-green-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">{{ employee.supervisor.user.get_full_name }}</p>
                            <p class="text-sm text-gray-500">Mi Supervisor</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="flex items-center space-x-3">
                        <div class="bg-purple-100 p-2 rounded-lg">
                            <i class="fas fa-id-badge text-purple-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">{{ employee.position.title }}</p>
                            <p class="text-sm text-gray-500">Mi Cargo</p>
                        </div>
                    </div>

                    {% if subordinates_count %}
                    <div class="flex items-center space-x-3">
                        <div class="bg-orange-100 p-2 rounded-lg">
                            <i class="fas fa-users text-orange-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">{{ subordinates_count }}</p>
                            <p class="text-sm text-gray-500">Personas a mi cargo</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Documentos Recientes y Subordinados -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Documentos Recientes -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Documentos Recientes</h3>
                    <a href="{% url 'employees:employee_documents' %}" class="text-blue-600 hover:text-blue-700 text-sm font-medium">Ver todos</a>
                </div>
                
                <div class="space-y-4">
                    {% for document in recent_documents %}
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                        <div class="bg-blue-100 p-2 rounded-lg">
                            <i class="fas fa-file text-blue-600"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">{{ document.name }}</p>
                            <p class="text-xs text-gray-500">{{ document.get_document_type_display }}</p>
                        </div>
                        <div class="text-xs text-gray-400">
                            {{ document.upload_date|timesince }} ago
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-file-alt text-3xl mb-3"></i>
                        <p>No tienes documentos registrados</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Mi Equipo (si tiene subordinados) -->
            {% if subordinates %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Mi Equipo</h3>
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                        {{ subordinates_count }} personas
                    </span>
                </div>
                
                <div class="space-y-4">
                    {% for subordinate in subordinates %}
                    <div class="flex items-center space-x-3">
                        <img src="https://via.placeholder.com/32x32/3b82f6/ffffff?text={{ subordinate.user.first_name|first|upper }}" 
                             alt="{{ subordinate.user.get_full_name }}" 
                             class="h-8 w-8 rounded-full">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">
                                {{ subordinate.user.get_full_name }}
                            </p>
                            <p class="text-xs text-gray-500">{{ subordinate.position.title }}</p>
                        </div>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Activo
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Información adicional si no tiene subordinados -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Información Laboral</h3>
                </div>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-600">Fecha de Ingreso</span>
                        <span class="text-sm text-gray-900">{{ employee.hire_date|date:"d/m/Y" }}</span>
                    </div>
                    
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-600">Tipo de Contrato</span>
                        <span class="text-sm text-gray-900">{{ employee.get_contract_type_display }}</span>
                    </div>
                    
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-600">Estado</span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            {{ employee.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animaciones para las tarjetas
        const cards = document.querySelectorAll('.bg-white');
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.5s ease';
                
                requestAnimationFrame(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });
            }, index * 100);
        });

        // Actualización de la hora actual
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES');
            const timeElement = document.querySelector('.current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // Actualizar cada segundo
        setInterval(updateTime, 1000);
    });
</script>
{% endblock %}